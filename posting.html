<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title> Assignment 3 </title>
</head>
<body style="background-color:powderblue;">
    Create a post <br>
    <br>Input topic: <br>
    <input type='text' id='tpc' />
    <br>Input data: <br>
    <input type='text' id='dta' />
    <br>
    <button type='button' value='Send' name='Send' onclick='send()'>
        Send
    </button>
    <br></br>
    <button type='button' value='Sort' name='SortTimeAsc' onclick="loadTable('Timestamp', 'ASC')">
        Sort by Time Asc.
    </button>
    <button type='button' value='Sort' name='SortTimeDesc' onclick="loadTable('Timestamp', 'DESC')">
        Sort by Time Desc.
    </button>
    <button type='button' value='Sort' name='SortTopicAsc' onclick="loadTable('Topic', 'Asc')">
        Sort by Topic Asc.
    </button>
    <button type='button' value='Sort' name='SortTopicDesc' onclick="loadTable('Topic', 'Desc')"'>
        Sort by Topic Desc.
    </button>
    <p id="posts-table"> </p> 
    
    <script type="text/javascript">
        //Samuel Guttormson, 11198900, sgg115

        //Loads the table, configures sorting
        function loadTable(sortType, orderType, req, res){
            //Setup up sort parameters to pass to server when we request the table
            if (sortType == null){
                sortType = "Timestamp";
            }
            if (orderType == null){
                orderType = "ASC";
            }
            var sorting = {
                sortType: sortType,
                orderType: orderType
            }
            //Instantiate new XMLHttpRequest, wait for state change and parse response into table
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    var data = JSON.parse(xhttp.response);
                    var table = "<table border='1' id='posts-table' >";              
                    table += "<thead> <tr> <th> Topic </th> <th> Data </th> <th> Timestamp </th> </tr> </thead>";
                    table += "<tbody>";
                    //iterate posts into the body of the table
                    for(x in data) {
                        table += "<tr> <td> " + data[x].Topic + "</td> <td>" + data[x].Data + "</td> <td>" + data[x].Timestamp + "</td> </tr>";
                    }
                    table += "</tbody> </table>";
                    document.getElementById("posts-table").innerHTML = table;                 
                }
            }
            xhttp.open('POST', '/load', true);
            xhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
            xhttp.send(JSON.stringify(sorting));
        }
        loadTable();

        //Send posts
        function send(req, res) {
            //Defining the parameters of a post
            var post = {
                topic: document.getElementById('tpc').value,
                data: document.getElementById('dta').value
            };

            //instantiating a new XMLHttpRequest and opening it
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/posts', true);
            xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
            xhr.send(JSON.stringify(post));
            //Reload the table
            loadTable();
        };

    </script>
</body>
</html>